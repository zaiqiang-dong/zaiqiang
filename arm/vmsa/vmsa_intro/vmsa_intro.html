<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VMSAV8简介 | 探索者</title>
    <meta name="description" content="-&gt; 在 LINUX ANDROID 中不断探索 &lt;-">
    <link rel="icon" href="/hero.png">
    
    <link rel="preload" href="/assets/css/0.styles.0f7e1314.css" as="style"><link rel="preload" href="/assets/js/app.874ab9b6.js" as="script"><link rel="preload" href="/assets/js/2.1e8a68fb.js" as="script"><link rel="preload" href="/assets/js/4.ebb014aa.js" as="script"><link rel="prefetch" href="/assets/js/10.2b62856d.js"><link rel="prefetch" href="/assets/js/11.ec5fccf9.js"><link rel="prefetch" href="/assets/js/12.b061ae84.js"><link rel="prefetch" href="/assets/js/13.c4e77bf6.js"><link rel="prefetch" href="/assets/js/14.192a5bf2.js"><link rel="prefetch" href="/assets/js/15.6da86d38.js"><link rel="prefetch" href="/assets/js/16.6d968c70.js"><link rel="prefetch" href="/assets/js/17.09892afd.js"><link rel="prefetch" href="/assets/js/18.98b88bd2.js"><link rel="prefetch" href="/assets/js/3.ab8082a9.js"><link rel="prefetch" href="/assets/js/5.f704f1a0.js"><link rel="prefetch" href="/assets/js/6.328d3f62.js"><link rel="prefetch" href="/assets/js/7.23ef1714.js"><link rel="prefetch" href="/assets/js/8.9dcad46d.js"><link rel="prefetch" href="/assets/js/9.e03bdb73.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0f7e1314.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">探索者</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/linux/" class="nav-link">linux</a></div><div class="nav-item"><a href="/arm/" class="nav-link router-link-active">arm</a></div><div class="nav-item"><a href="/selinux/" class="nav-link">selinux</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/linux/" class="nav-link">linux</a></div><div class="nav-item"><a href="/arm/" class="nav-link router-link-active">arm</a></div><div class="nav-item"><a href="/selinux/" class="nav-link">selinux</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ARM简介</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>虚拟内存</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html" class="active sidebar-link">VMSAV8简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_0-vmsav8命名" class="sidebar-link">0 VMSAV8命名</a></li><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_1-vmsav8地址类型和地址空间" class="sidebar-link">1 VMSAV8地址类型和地址空间</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_1-1-va" class="sidebar-link">1.1 VA</a></li><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_1-2-ipa" class="sidebar-link">1.2 IPA</a></li><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_1-3-pa" class="sidebar-link">1.3 PA</a></li></ul></li><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_2-地址标签" class="sidebar-link">2 地址标签</a></li><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_4-地址转换与异常等级" class="sidebar-link">4 地址转换与异常等级</a></li><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#_5-地址转换粒度" class="sidebar-link">5 地址转换粒度</a></li><li class="sidebar-sub-header"><a href="/arm/vmsa/vmsa_intro/vmsa_intro.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/arm/vmsa/vmsa_page/vmsa_page.html" class="sidebar-link">VMSAv8页表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vmsav8简介"><a href="#vmsav8简介" class="header-anchor">#</a> VMSAV8简介</h1> <hr> <table><thead><tr><th>软件版本</th> <th>硬件版本</th> <th>更新内容</th></tr></thead> <tbody><tr><td>linux 4.14</td> <td>armv8-64</td> <td>first</td></tr></tbody></table> <hr> <p>VMSA即Virtual Memory System Architecturer的缩写，中文为虚拟内存系统架构。VMSA提供一个内存管理单元(MMU)，用于控制地址转换、访问权限和内存属性的确定和检查。地址转换就是将虚拟地址(VA)映射到物理地址(PA)。VA到PA的映射需要一个单独的翻译阶段，或者两个连续的翻译阶段，也就是stage。</p> <h2 id="_0-vmsav8命名"><a href="#_0-vmsav8命名" class="header-anchor">#</a> 0 VMSAV8命名</h2> <ol><li>VMSAv8-32　运行在AArch32模式下的地址转换，可能存在一个stage或者两个连续的stage.</li> <li>VMSAv8-64　运行在AArch64模式下的地址转换，可能存在一个stage或者两个连续的stage.</li> <li>VMSAv8　通指以上两种。</li></ol> <h2 id="_1-vmsav8地址类型和地址空间"><a href="#_1-vmsav8地址类型和地址空间" class="header-anchor">#</a> 1 VMSAV8地址类型和地址空间</h2> <h3 id="_1-1-va"><a href="#_1-1-va" class="header-anchor">#</a> 1.1 VA</h3> <p>VA也就是Virtual address虚拟地址缩写。在V8中最大支持48bit 的地址宽度。
地址范围从0x0000 0000 0000 0000 到 0x0000 FFFF FFFF FFFF</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在ARMv8.2-LVA中，52bits地址宽度的地址将被支持。</p></div> <h3 id="_1-2-ipa"><a href="#_1-2-ipa" class="header-anchor">#</a> 1.2 IPA</h3> <p>IPA即Intermediate physical address的缩写，在一次虚拟地址到物理地址的转换过程中，可能会包括两个stage,那第么IPA就是stage1的输出，stage2的输入，它是一个中间产物。如下图所示：</p> <p><img src="data:image/png;base64,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" alt="ipa"></p> <h3 id="_1-3-pa"><a href="#_1-3-pa" class="header-anchor">#</a> 1.3 PA</h3> <p>PA即Physical address的缩写，就是物理地址，也就是直正的地址总线编址的地址。</p> <h2 id="_2-地址标签"><a href="#_2-地址标签" class="header-anchor">#</a> 2 地址标签</h2> <p>在内核文档Memory Layout on AArch64 Linux中有如下表述：</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>User addresses have bits 63:48 set to 0 while the kernel addresses have the same bits set to 1. TTBRx selection is given by bit 63 of the virtual address. The swapper_pg_dir contains only kernel (global) mappings while the user pgd contains only user (non-global) mappings. The swapper_pg_dir address is written to TTBR1 and never written to TTBR0.</p></div> <p>也就是内核把VA空间分为两段：</p> <ul><li>0x0000 0000 0000 0000 到　0x0000 FFFF FFFF FFFF　为user地址空间</li> <li>0xFFFF 0000 0000 0000 到　0xFFFF FFFF FFFF FFFF　为内核空间</li></ul> <p>这样的全部的地址空间就是256T+256T，这和我们之前说的最大48bits地址总线宽度256T的空间不一致，其实很简单，原因就是有两个页表基址寄存器：TTBR1和TTBR0.</p> <p>在看一下arm参考手册中的描述</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>For addresses when stage 1 translation can support two VA ranges</p></div> <table><thead><tr><th>VA[55]</th> <th>描述</th></tr></thead> <tbody><tr><td>0</td> <td>如果使能了 stage 1 的转换, 那么 TCR_ELx.TBI0 控制是否启用 address tags 功能.寄存器 TTBR0_ELx 保存地址转换表的基地址.</td></tr> <tr><td>1</td> <td>如果使能了 stage 1 的转换, 那么 TCR_ELx.TBI1 控制是否启用 address tags 功能. 寄存器 TTBR1_ELx 保存地址转换表的基地址.</td></tr></tbody></table> <p>基本上也是一个意思。关于地址标签，就了解这些还有一些其他的信息，可以参考手册。</p> <h2 id="_4-地址转换与异常等级"><a href="#_4-地址转换与异常等级" class="header-anchor">#</a> 4 地址转换与异常等级</h2> <p>它两之间的关系主要如下图：
<img src="/assets/img/el.125081e3.png" alt="el"></p> <p>在这个小节中我们主要了解，我们的linux 内核是运行在EL1 非加密的异常等级上就够了。</p> <h2 id="_5-地址转换粒度"><a href="#_5-地址转换粒度" class="header-anchor">#</a> 5 地址转换粒度</h2> <p>在arm参考手册中主要支持３种粒度：4K 16K 64K，信息如下图所示：
<img src="/assets/img/granule.3c85fb3c.png" alt="granule">
在内核中，我们主要使用就是48bits 地址宽度和4k页面大小。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>+--------+--------+--------+--------+--------+--------+--------+--------+
|63    56|55    48|47    40|39    32|31    24|23    16|15     8|7      0|
+--------+--------+--------+--------+--------+--------+--------+--------+
 |                 |         |         |         |         |
 |                 |         |         |         |         v
 |                 |         |         |         |   [11:0]  in-page offset
 |                 |         |         |         +-&gt; [20:12] L3 index
 |                 |         |         +-----------&gt; [29:21] L2 index
 |                 |         +---------------------&gt; [38:30] L1 index
 |                 +-------------------------------&gt; [47:39] L0 index
 +-------------------------------------------------&gt; [63] TTBR0/1
 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当然你也可以配置64K</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>+--------+--------+--------+--------+--------+--------+--------+--------+
|63    56|55    48|47    40|39    32|31    24|23    16|15     8|7      0|
+--------+--------+--------+--------+--------+--------+--------+--------+
 |                 |    |               |              |
 |                 |    |               |              v
 |                 |    |               |            [15:0]  in-page offset
 |                 |    |               +----------&gt; [28:16] L3 index
 |                 |    +--------------------------&gt; [41:29] L2 index
 |                 +-------------------------------&gt; [47:42] L1 index (48-bit)
 |                                                   [51:42] L1 index (52-bit)
 +-------------------------------------------------&gt; [63] TTBR0/1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>本文介绍了VMSAv8的一些基本信息，有一点就是我们关注的更多的是和软件关系密切的部分，其实的部分大家可以通过arm参考手册了解。</p> <hr> <div class="custom-block tip"><p class="custom-block-title">参考文件</p> <p><a href="https://www.arm.com/zh/files/downloads/ARMv8_white_paper_v5.pdf" target="_blank" rel="noopener noreferrer">ARMv8_white_paper_v5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://silver.arm.com/download/ARM_and_AMBA_Architecture/AR150-DA-70000-r0p0-07eac0/DDI0487E_a_armv8_arm.pdf" target="_blank" rel="noopener noreferrer">Armv8-A architecture profile <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.kernel.org/doc/html/latest/arm64/memory.html" target="_blank" rel="noopener noreferrer">Memory Layout on AArch64 Linux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <hr> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>转载请注明出处！ <a href="http://www.cxy.wiki" target="_blank" rel="noopener noreferrer">探索者<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新 :</span> <span class="time">10/11/2019, 10:26:38 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/arm/intro.html" class="prev">简介</a></span> <span class="next"><a href="/arm/vmsa/vmsa_page/vmsa_page.html">VMSAv8页表</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.874ab9b6.js" defer></script><script src="/assets/js/2.1e8a68fb.js" defer></script><script src="/assets/js/4.ebb014aa.js" defer></script>
  </body>
</html>
