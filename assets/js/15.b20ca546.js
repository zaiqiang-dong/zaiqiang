(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{233:function(s,n,t){"use strict";t.r(n);var a=t(0),r=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"进程优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进程优先级"}},[s._v("#")]),s._v(" 进程优先级")]),s._v(" "),t("hr"),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("软件版本")]),s._v(" "),t("th",[s._v("硬件版本")]),s._v(" "),t("th",[s._v("更新内容")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("linux 4.9")]),s._v(" "),t("td",[s._v("arm64")]),s._v(" "),t("td")])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),t("p",[s._v("由于进程优先级在用户空间和内核空间的定义不同，而且在内核空间也存在多种优先级，所以让人比较费解。本文将介绍linux系统中的各种优先，算是作一个总结吧。")]),s._v(" "),t("h2",{attrs:{id:"用户空间进程优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户空间进程优先级"}},[s._v("#")]),s._v(" 用户空间进程优先级")]),s._v(" "),t("p",[s._v("在用户空间对于优先级的控制接口大概有3个，如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("int nice (int __inc);\nint getpriority(int which, id_t who);\nint setpriority(int which, id_t who, int value);\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("其中nice()源码如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("int\nnice (int incr)\n{\n  int save;\n  int prio;\n  int result;\n\n  /* -1 is a valid priority, so we use errno to check for an error.  */\n  save = errno;\n  __set_errno (0);\n  prio = __getpriority (PRIO_PROCESS, 0);\n  if (prio == -1)\n    {\n      if (errno != 0)\n\treturn -1;\n    }\n\n  result = __setpriority (PRIO_PROCESS, 0, prio + incr);\n  if (result == -1)\n    {\n      if (errno == EACCES)\n\t__set_errno (EPERM);\n      return -1;\n    }\n\n  __set_errno (save);\n  return __getpriority (PRIO_PROCESS, 0);\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("所以只有setpriority getpriority.\n当我们 man setpriority时，可以看到：")]),s._v(" "),t("blockquote",[t("p",[s._v("The prio argument is a value in the range -20 to 19 (but see NOTES below).")])]),s._v(" "),t("p",[s._v("所以在用户空间priority概念只有一个，就是一个-20（优先级最高）～19（优先级最低)的整数。")]),s._v(" "),t("h2",{attrs:{id:"内核中的优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内核中的优先级"}},[s._v("#")]),s._v(" 内核中的优先级")]),s._v(" "),t("p",[s._v("先看代码：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("struct task_struct {\n\t...\n    int prio, static_prio, normal_prio;\n\tunsigned int rt_priority;\n\t...\n    unsigned int policy;\n\t...\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("侍完成...")]),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("转载请注明出处！ "),t("a",{attrs:{href:"http://www.cxy.wiki",target:"_blank",rel:"noopener noreferrer"}},[s._v("探索者"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=r.exports}}]);